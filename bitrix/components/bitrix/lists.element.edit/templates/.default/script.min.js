BX.namespace("BX.Lists");BX.Lists.ListsElementEditClass=function(){var t=function(t){this.randomString=t.randomString;this.ajaxUrl="/bitrix/components/bitrix/lists.element.edit/ajax.php";this.urlTabBp=t.urlTabBp;this.iblockTypeId=t.iblockTypeId;this.iblockId=t.iblockId;this.elementId=t.elementId;this.socnetGroupId=t.socnetGroupId;this.sectionId=t.sectionId;this.jsClass="ListsElementEditClass_"+t.randomString;this.elementUrl=t.elementUrl;if(t.isConstantsTuned){this.isConstantsTuned()}};t.prototype.completeWorkflow=function(t,s){BX.Lists.ajax({method:"POST",dataType:"json",url:BX.Lists.addToLinkParam(this.ajaxUrl,"action","completeWorkflow"),data:{workflowId:t,iblockTypeId:this.iblockTypeId,elementId:this.elementId,iblockId:this.iblockId,socnetGroupId:this.socnetGroupId,sectionId:this.sectionId,action:s},onsuccess:BX.delegate(function(t){if(t.status=="success"){BX.Lists.showModalWithStatusAction({status:"success",message:t.message});setTimeout(BX.delegate(function(){document.location.href=this.urlTabBp},this),1e3)}else{t.errors=t.errors||[{}];BX.Lists.showModalWithStatusAction({status:"error",message:t.errors.pop().message})}},this)})};t.prototype.isConstantsTuned=function(){BX.Lists.ajax({method:"POST",dataType:"json",url:BX.Lists.addToLinkParam(this.ajaxUrl,"action","isConstantsTuned"),data:{iblockTypeId:this.iblockTypeId,iblockId:this.iblockId,socnetGroupId:this.socnetGroupId,sectionId:this.sectionId},onsuccess:BX.delegate(function(t){if(t.status=="success"){if(t.admin===false){this.notifyAdmin()}else{this.fillConstants(t.templateData)}}else{t.errors=t.errors||[{}];BX.Lists.showModalWithStatusAction({status:"error",message:t.errors.pop().message})}},this)})};t.prototype.fillConstants=function(t){if(!t){return}BX.Lists.ajax({method:"POST",dataType:"html",url:BX.Lists.addToLinkParam(this.ajaxUrl,"action","fillConstants"),data:{iblockId:this.iblockId,listTemplateId:t},onsuccess:BX.delegate(function(t){BX.adjust(BX("lists-fill-constants-content"),{html:t})},this)});var s=BX.Lists.modalWindow({modalId:"bx-lists-popup",withoutWindowManager:true,title:BX.message("CT_BLEE_BIZPROC_CONSTANTS_FILL_TITLE"),overlay:false,contentStyle:{width:"600px",paddingTop:"10px",paddingBottom:"10px"},content:[BX("lists-fill-constants-content")],events:{onPopupClose:function(){BX("lists-fill-constants").appendChild(BX("lists-fill-constants-content"));this.destroy()},onAfterPopupShow:function(t){var s=BX.findChild(t.contentContainer,{className:"bx-lists-popup-title"},true);if(s){s.style.cursor="move";BX.bind(s,"mousedown",BX.proxy(t._startDrag,t))}}},buttons:[BX.create("a",{text:BX.message("CT_BLEE_BIZPROC_SAVE_BUTTON"),props:{className:"webform-small-button webform-small-button-accept"},events:{click:BX.delegate(function(t){var e=BX.findChild(BX("lists-fill-constants-content"),{tag:"FORM"},true);if(e){e.modalWindow=s;e.onsubmit(e,t)}})}}),BX.create("a",{text:BX.message("CT_BLEE_BIZPROC_CANCEL_BUTTON"),props:{className:"webform-small-button webform-button-cancel"},events:{click:BX.delegate(function(t){if(!!s)s.close()},this)}})]})};t.prototype.notifyAdmin=function(){BX.Lists.ajax({method:"POST",dataType:"json",url:BX.Lists.addToLinkParam(this.ajaxUrl,"action","getListAdmin"),data:{iblockId:this.iblockId,iblockTypeId:this.iblockTypeId,socnetGroupId:this.socnetGroupId,sectionId:this.sectionId},onsuccess:BX.delegate(function(t){if(t.status=="success"){var s=this.createHtmlNotifyAdmin(t.listAdmin);BX("lists-notify-admin-popup-content").appendChild(s);BX.Lists.modalWindow({modalId:"bx-lists-popup",title:BX.message("CT_BLEE_BIZPROC_NOTIFY_TITLE"),overlay:false,contentStyle:{width:"600px",paddingTop:"10px",paddingBottom:"10px"},content:[BX("lists-notify-admin-popup-content")],events:{onPopupClose:function(){BX("lists-notify-admin-popup").appendChild(BX("lists-notify-admin-popup-content"));this.destroy()},onAfterPopupShow:function(t){var s=BX.findChild(t.contentContainer,{className:"bx-lists-popup-title"},true);if(s){s.style.cursor="move";BX.bind(s,"mousedown",BX.proxy(t._startDrag,t))}}},buttons:[BX.create("a",{text:BX.message("CT_BLEE_BIZPROC_NOTIFY_ADMIN_BUTTON_CLOSE"),props:{className:"webform-small-button webform-button-cancel"},events:{click:BX.delegate(function(t){BX.PopupWindowManager.getCurrentPopup().close()},this)}})]})}else{t.errors=t.errors||[{}];BX.Lists.showModalWithStatusAction({status:"error",message:t.errors.pop().message})}},this)})};t.prototype.notify=function(t){if(!BX("lists-notify-button-"+t)){return}BX("lists-notify-button-"+t).setAttribute("onclick","");BX.Lists.ajax({method:"POST",dataType:"json",url:BX.Lists.addToLinkParam(this.ajaxUrl,"action","notifyAdmin"),data:{iblockId:this.iblockId,userId:t,iblockTypeId:this.iblockTypeId,socnetGroupId:this.socnetGroupId,sectionId:this.sectionId,elementUrl:this.elementUrl},onsuccess:BX.delegate(function(s){if(s.status=="success"){BX.Lists.removeElement(BX("lists-notify-button-"+t));BX("lists-notify-success-"+t).innerHTML=s.message}else{BX("lists-notify-button-"+t).setAttribute("onclick",'BX.Lists["'+this.jsClass+'"].notify("'+t+'");');s.errors=s.errors||[{}];BX.Lists.showModalWithStatusAction({status:"error",message:s.errors.pop().message})}},this)})};t.prototype.createHtmlNotifyAdmin=function(t){if(!t){return null}var s;s=BX.create("div",{children:[BX.create("span",{props:{className:"lists-notify-question"},children:[BX.create("span",{props:{innerHTML:"!",className:"icon"}}),BX.create("span",{props:{innerHTML:BX.message("CT_BLEE_BIZPROC_SELECT_STAFF_SET_RESPONSIBLE")}})]}),BX.create("p",{html:BX.message("CT_BLEE_BIZPROC_NOTIFY_ADMIN_TEXT_ONE")}),BX.create("p",{html:BX.message("CT_BLEE_BIZPROC_NOTIFY_ADMIN_TEXT_TWO")}),BX.create("span",{props:{className:"lists-notify-question-title"},html:BX.message("CT_BLEE_BIZPROC_NOTIFY_ADMIN_MESSAGE")})]});for(var e in t){var i;if(t[e].img){i=BX.create("img",{attrs:{src:t[e].img}})}s.appendChild(BX.create("div",{props:{className:"lists-notify-question-item"},children:[BX.create("a",{props:{className:"lists-notify-question-item-avatar"},attrs:{href:"javascript:void(0)"},children:[BX.create("span",{props:{id:"lists-notify-question-item-avatar-inner",className:"lists-notify-question-item-avatar-inner"},children:[i]})]}),BX.create("span",{props:{className:"lists-notify-question-item-info"},children:[BX.create("span",{html:t[e].name})]}),BX.create("span",{props:{id:"lists-notify-success-"+t[e].id,className:"lists-notify-success"}}),BX.create("a",{props:{id:"lists-notify-button-"+t[e].id,className:"webform-small-button lists-notify-small-button webform-small-button-blue"},attrs:{href:"javascript:void(0)",onclick:'BX.Lists["'+this.jsClass+'"].notify("'+t[e].id+'");'},html:BX.message("CT_BLEE_BIZPROC_NOTIFY_ADMIN_MESSAGE_BUTTON")})]}))}return s};t.prototype.elementDelete=function(t,s){var e=document.getElementById(t);var i=document.getElementById("action");if(e&&i){if(confirm(s)){i.value="delete";e.submit()}}};t.prototype.createAdditionalHtmlEditor=function(t,s,e){var i=document.getElementById(t);var o=i.rows.length;var a=i.insertRow(o);var n=a.insertCell(0);var r=i.rows[o-1].cells[0].innerHTML;var l=0,c,d,p;while(true){c=r.indexOf("[n",l);if(c<0)break;d=r.indexOf("]",c);if(d<0)break;p=parseInt(r.substr(c+2,d-c));r=r.substr(0,c)+"[n"+ ++p+"]"+r.substr(d+1);l=c+1}l=0;while(true){c=r.indexOf("__n",l);if(c<0)break;d=r.indexOf("_",c+2);if(d<0)break;p=parseInt(r.substr(c+3,d-c));r=r.substr(0,c)+"__n"+ ++p+"_"+r.substr(d+1);l=d+1}n.innerHTML=r;var m="id_"+s+"__n"+o+"_";var u=s+"[n"+o+"][VALUE]";window.BXHtmlEditor.Show({id:m,inputName:u,name:u,content:"",width:"100%",height:"200",allowPhp:false,limitPhpAccess:false,templates:[],templateId:"",templateParams:[],componentFilter:"",snippets:[],placeholder:"Text here...",actionUrl:"/bitrix/tools/html_editor_action.php",cssIframePath:"/bitrix/js/fileman/html_editor/iframe-style.css?1412693817",bodyClass:"",bodyId:"",spellcheck_path:"/bitrix/js/fileman/html_editor/html-spell.js?v=1412693817",usePspell:"N",useCustomSpell:"Y",bbCode:false,askBeforeUnloadPage:false,settingsKey:"user_settings_1",showComponents:true,showSnippets:true,view:"wysiwyg",splitVertical:false,splitRatio:"1",taskbarShown:false,taskbarWidth:"250",lastSpecialchars:false,cleanEmptySpans:true,lazyLoad:false,showTaskbars:false,showNodeNavi:false,controlsMap:[{id:"Bold",compact:true,sort:"80"},{id:"Italic",compact:true,sort:"90"},{id:"Underline",compact:true,sort:"100"},{id:"Strikeout",compact:true,sort:"110"},{id:"RemoveFormat",compact:true,sort:"120"},{id:"Color",compact:true,sort:"130"},{id:"FontSelector",compact:false,sort:"135"},{id:"FontSize",compact:false,sort:"140"},{separator:true,compact:false,sort:"145"},{id:"OrderedList",compact:true,sort:"150"},{id:"UnorderedList",compact:true,sort:"160"},{id:"AlignList",compact:false,sort:"190"},{separator:true,compact:false,sort:"200"},{id:"InsertLink",compact:true,sort:"210"},{id:"InsertImage",compact:false,sort:"220"},{id:"InsertVideo",compact:true,sort:"230"},{id:"InsertTable",compact:false,sort:"250"},{id:"Smile",compact:false,sort:"280"},{separator:true,compact:false,sort:"290"},{id:"Fullscreen",compact:false,sort:"310"},{id:"More",compact:true,sort:"400"}],autoResize:true,autoResizeOffset:"40",minBodyWidth:"350",normalBodyWidth:"555"});var f=BX.findChildrenByClassName(BX(t),"bx-html-editor");for(var h in f){var B=f[h].getAttribute("id");var I=BX.findChildrenByClassName(BX(B),"bx-editor-iframe");if(I.length>1){for(var X=0;X<I.length-1;X++){I[X].parentNode.removeChild(I[X])}}}};return t}();
//# sourceMappingURL=script.map.js