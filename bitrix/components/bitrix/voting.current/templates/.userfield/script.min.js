(function(t){if(top.BVotedUser)return;top.voteGetID=function(){return"vote"+(new Date).getTime()};top.FormToArray=function(t,e){e=!!e?e:[];if(!!t){var i,o=[],s=t.elements.length;for(i=0;i<s;i++){var n=t.elements[i];if(n.disabled)continue;switch(n.type.toLowerCase()){case"text":case"textarea":case"password":case"hidden":case"select-one":o.push({name:n.name,value:n.value});break;case"radio":case"checkbox":if(n.checked)o.push({name:n.name,value:n.value});break;case"select-multiple":for(var r=0;r<n.options.length;r++){if(n.options[r].selected)o.push({name:n.name,value:n.options[r].value})}break;default:break}}var a=e;i=0;while(i<o.length){var p=o[i].name.indexOf("[");if(p==-1){a[o[i].name]=o[i].value;a=e;i++}else{var u=o[i].name.substring(0,p);var l=o[i].name.substring(p+1);if(!a[u])a[u]=[];var d=l.indexOf("]");if(d==-1){a=e;i++}else if(d==0){a=a[u];o[i].name=""+a.length}else{a=a[u];o[i].name=l.substring(0,d)+l.substring(d+1)}}}}return e};var e=null;top.VCButtonShowWait=function(t){if(t.disabled!==true){if(t&&!BX.type.isElementNode(t))t=null;t=t||this;t=t?t.tagName=="A"?t:t.parentNode:t;if(t){BX.addClass(t,"feed-add-button-load");e=t;BX.defer(function(){t.disabled=true})()}}};top.VCButtonCloseWait=function(t){if(t&&!BX.type.isElementNode(t))t=null;t=t||e||this;if(t){t.disabled=false;BX.removeClass(t,"feed-add-button-load");e=null}};top.VCLinkCloseWait=function(t){if(top.VCButtonCloseWait(t)===false){if(t&&!BX.type.isElementNode(t))t=null;t=t||this;if(BX.type.isElementNode(t)){t.disabled=false;t.setAttribute("href",t.getAttribute("rel"));BX.removeClass(t,"bx-vote-loading")}}};top.VCLinkShowWait=function(t){if(top.VCButtonShowWait(t)===false&&t.disabled!==true){if(t&&!BX.type.isElementNode(t))t=null;t=t||this;if(BX.type.isElementNode(t)){t.disabled=true;BX.defer(function(){t.setAttribute("rel",t.getAttribute("href"));t.setAttribute("href","javascript:void(0);")})();BX.addClass(t,"bx-vote-loading")}}};top.voteSendForm=function(t,e,i){if(!!e){top.voteAJAX(t,i,e.action,top.FormToArray(e,{AJAX_POST:"Y"}))}};top.voteGetForm=function(t,e,i){var o=t.getAttribute("href").replace(/.AJAX_RESULT=Y/g,"").replace(/.AJAX_POST=Y/g,"").replace(/.sessid=[^&]*/g,"").replace(/.VOTE_ID=([\d]+)/,"").replace(/.view_form=Y/g,"").replace(/.view_result=Y/g,""),s={view_form:"Y",VOTE_ID:e,AJAX_POST:"Y",sessid:BX.bitrix_sessid()};top.voteAJAX(t,i,o,s);return false};top.voteAJAX=function(e,i,o,s){if(e.disabled===true)return false;top.VCLinkShowWait(e);BX.ajax({method:"POST",processData:false,url:o,data:s,onsuccess:function(o){top.VCLinkCloseWait(e);var s=BX.processHTML(o,false),n=BX.findParent(e,{className:"bx-vote-block"});if(!!n){n.innerHTML=s.HTML;BX.removeClass(n,"bx-vote-block-result");BX.removeClass(n,"bx-vote-block-result-view");if(s.HTML.indexOf("<form")<0){BX.addClass(n,"bx-vote-block-result")}BX.defer(function(){BX.ajax.processScripts(s.SCRIPT)})()}if(!!t["BVote"+i]){t["BVote"+i].__destruct();t["BVote"+i]=null}}});return true};top.voteGetResult=function(e,i,o){top.VCLinkShowWait(o);BX.addCustomEvent(e,"OnBeforeChangeData",function(){var t=BX.findParent(e,{className:"bx-vote-block"});BX.addClass(t,"bx-vote-block-result");top.VCLinkCloseWait(o)});BX.addCustomEvent(e,"OnAfterChangeData",function(){if(!!o)BX.hide(o)});t["BVote"+i].send(true);return false};top.BVotedUser=function(t){this.CID=t["CID"];this.url=t["url"];this.urlTemplate=t["urlTemplate"];this.nameTemplate=t["nameTemplate"];this.dateTemplate=t["dateTemplate"];this.data={};this.popup=null;this.controller=t["controller"];this.startCheck=!!t["startCheck"]?parseInt(t["startCheck"]):false;this.voteId=t["voteId"];this.status="ready";this.__construct()};top.BVotedUser.prototype.__construct=function(){var t=BX.findChildren(this.controller,{tagName:"A",className:"bx-vote-voted-users"},true),e,i=BX.delegate(function(){this.get()},this);for(e in t){if(t.hasOwnProperty(e)){BX.bind(t[e],"click",i)}}this.onPullEvent=BX.delegate(function(t,e){if(t=="voting"&&!!e&&e["VOTE_ID"]==this.voteId){var i=BX.findParent(this.controller,{className:"bx-vote-block"});if(!!i&&BX.hasClass(i,"bx-vote-block-result")){this.changeData(e)}}},this);BX.addCustomEvent("onPullEvent-vote",this.onPullEvent)};top.BVotedUser.prototype.__destruct=function(){var t=BX.findChildren(this.controller,{tagName:"A",className:"bx-vote-voted-users"},true),e;if(!!t){for(e in t){if(t.hasOwnProperty(e)){BX.unbindAll(t[e])}}}BX.removeCustomEvent("onPullEvent",this.onPullEvent)};top.BVotedUser.prototype.init=function(t){var e=BX.proxy_context;if(!!e.timeoutOver){clearTimeout(e.timeoutOver);e.timeoutOver=false}if(t.type=="mouseover"){e.timeoutOver=setTimeout(BX.proxy(function(){this.get(e);if(this.popup){BX.bind(this.popup.popupContainer,"mouseout",BX.proxy(function(){this.popup.timeoutOut=setTimeout(BX.proxy(function(){if(this.node==e&&!!this.popup){this.popup.close()}},this),400)},this));BX.bind(this.popup.popupContainer,"mouseover",BX.proxy(function(){if(this.popup.timeoutOut)clearTimeout(this.popup.timeoutOut)},this))}},this),400)}};top.BVotedUser.prototype.getID=function(){return"vote"+(new Date).getTime()};top.BVotedUser.prototype.make=function(t,e){if(!this.popup)return true;e=e!==false;var i=this.popup&&this.popup.contentContainer?this.popup.contentContainer:BX("popup-window-content-bx-vote-popup-cont-"+this.CID),o=false,s=false,n;if(this.popup.isNew){o=BX.create("SPAN",{props:{className:"bx-ilike-popup"},children:[BX.create("SPAN",{props:{className:"bx-ilike-bottom_scroll"}})]});s=BX.create("SPAN",{props:{className:"bx-ilike-wrap-block"},children:[o]})}else{o=BX.findChild(this.popup.contentContainer,{className:"bx-ilike-popup"},true)}if(!!o&&typeof t.items=="object"){for(n in t.items){if(t.items.hasOwnProperty(n)&&!BX.findChild(o,{tag:"A",attr:{id:"a"+t["answer_id"]+"u"+t.items[n]["ID"]}},true)){o.appendChild(BX.create("A",{attrs:{id:"a"+t["answer_id"]+"u"+t.items[n]["ID"]},props:{href:t.items[n]["URL"],target:"_blank",className:"bx-ilike-popup-img"},text:"",children:[BX.create("SPAN",{props:{className:"bx-ilike-popup-avatar"},html:t.items[n]["PHOTO"]}),BX.create("SPAN",{props:{className:"bx-ilike-popup-name"},html:t.items[n]["FULL_NAME"]})]}))}}}if(this.popup.isNew){this.popup.isNew=false;if(!!i){try{i.removeChild(i.firstChild)}catch(r){}i.appendChild(s)}}this.adjustWindow();if(e)this.popupScroll();return true};top.BVotedUser.prototype.show=function(){if(this.popup!=null&&this.node.id!=this.popup.nodeID)this.popup.close();if(this.popup==null){this.popup=new BX.PopupWindow("bx-vote-popup-cont-"+this.CID,this.node,{lightShadow:true,offsetTop:-2,offsetLeft:3,autoHide:true,closeByEsc:true,bindOptions:{position:"top"},events:{onPopupClose:function(){this.destroy()},onPopupDestroy:BX.proxy(function(){this.popup=null},this)},content:BX.create("SPAN",{props:{className:"bx-ilike-wait"}})});this.popup.nodeID=this.node.id;this.popup.isNew=true;this.popup.show()}this.popup.setAngle({position:"bottom"});this.adjustWindow()};top.BVotedUser.prototype.adjustWindow=function(){if(this.popup!=null){this.popup.bindOptions.forceBindPosition=true;this.popup.adjustPosition();this.popup.bindOptions.forceBindPosition=false}};top.BVotedUser.prototype.popupScroll=function(){if(this.popup){var t=BX.findChild(this.popup.contentContainer,{className:"bx-ilike-popup"},true);BX.bind(t,"scroll",BX.proxy(this.popupScrollCheck,this))}};top.BVotedUser.prototype.popupScrollCheck=function(){var t=BX.proxy_context;if(t.scrollTop>(t.scrollHeight-t.offsetHeight)/1.5){BX.unbind(t,"scroll",BX.proxy(this.popupScrollCheck,this));this.get(this.popup.bindElement)}};top.BVotedUser.prototype.get=function(t){this.node=!!t?t:BX.proxy_context;if(!this.node)return false;if(!this.node.getAttribute("id"))this.node.setAttribute("id",this.getID());if(!this.node.getAttribute("rel")&&!this.node.getAttribute("rev")||parseInt(this.node.innerHTML)<=0)return false;if(this.node.getAttribute("status")==="busy")return false;if(!this.node.getAttribute("inumpage"))this.node.setAttribute("inumpage","1");else if(this.node.getAttribute("inumpage")!="done")this.node.setAttribute("inumpage",parseInt(this.node.getAttribute("inumpage"))+1+"");this.show();if(this.data[this.node.getAttribute("id")])this.make(this.data[this.node.getAttribute("id")],this.node.getAttribute("inumpage")!="done");if(this.node.getAttribute("inumpage")!="done"){this.node.setAttribute("status","busy");BX.ajax({url:"/bitrix/components/bitrix/voting.current/templates/.userfield/users.php",method:"POST",dataType:"json",data:{ID:this.node.getAttribute("rel"),answer_id:this.node.getAttribute("rev"),request_id:this.node.getAttribute("id"),iNumPage:this.node.getAttribute("inumpage"),URL_TEMPLATE:this.urlTemplate,NAME_TEMPLATE:this.nameTemplate,sessid:BX.bitrix_sessid()},onsuccess:BX.proxy(function(t){if(!!t&&!!t.items){t["StatusPage"]=!!t["StatusPage"]?t["StatusPage"]:false;if(t.StatusPage=="done"||t.items.length<=0)this.node.setAttribute("inumpage","done");var e,i=this.data[this.node.getAttribute("id")]?this.data[this.node.getAttribute("id")]["items"]:[];for(e=0;e<t.items.length;e++){i.push(t.items[e])}this.data[this.node.getAttribute("id")]=t;this.data[this.node.getAttribute("id")]["items"]=i;this.make(this.data[this.node.getAttribute("id")],this.node.getAttribute("inumpage")!="done")}this.node.setAttribute("status","ready")},this),onfailure:BX.proxy(function(){this.node.setAttribute("status","ready")},this)})}return true};top.BVotedUser.prototype.send=function(){if(this.status==="ready"){this.status="busy";BX.ajax({url:this.url.replace(/.AJAX_RESULT=Y/g,"").replace(/.AJAX_POST=Y/g,"").replace(/.sessid=[^&]*/g,"").replace(/.VOTE_ID=([\d]+)/,"").replace(/.view_form=Y/g,"").replace(/.view_result=Y/g,""),method:"POST",dataType:"json",data:{VOTE_ID:this.voteId,AJAX_RESULT:"Y",view_result:"Y",sessid:BX.bitrix_sessid()},onsuccess:BX.proxy(function(t){this.changeData(t);this.status="ready"},this),onfailure:BX.proxy(function(){this.status="ready"},this)})}};top.BVotedUser.prototype.changeData=function(t){t=t["QUESTIONS"];BX.onCustomEvent(this.controller,"OnBeforeChangeData");var e,i,o,s,n;for(s in t){if(t.hasOwnProperty(s)){e=BX.findChild(this.controller,{attr:{id:"question"+s}},true);if(!!e){for(o in t[s]){if(t[s].hasOwnProperty(o)){i=BX.findChild(e,{attr:{id:"answer"+o}},true);if(!!i){n=parseInt(t[s][o]["PERCENT"]);n=isNaN(n)?0:n;BX.adjust(BX.findChild(i,{tagName:"A",className:"bx-vote-voted-users"},true),{attrs:{id:"",rel:t[s][o]["USERS"],rev:o,inumpage:false},html:t[s][o]["COUNTER"]});BX.adjust(BX.findChild(i,{tagName:"SPAN",className:"bx-vote-data-percent"},true),{html:n+"%"});BX.adjust(BX.findChild(i,{tagName:"DIV",className:"bx-vote-result-bar"},true),{style:{width:n+"%"}})}}}}}}BX.onCustomEvent(this.controller,"OnAfterChangeData")}})(window);
//# sourceMappingURL=script.map.js