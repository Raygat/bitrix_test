(function(e){if(BX.Scale.AdminFrame)return;BX.Scale.AdminFrame={frameObjectName:"",srvFrameObjectName:"",currentAsyncActionBID:"",timeAsyncRefresh:2e4,timeIntervalId:"",graphPageUrl:"",failureAnswersCount:0,failureAnswersCountAllow:5,nextActionId:null,init:function(e){for(var t in e)this[t]=e[t]},build:function(){var e=BX(this.frameObjectName);if(!e)return false;this.showActions();this.showServers();return true},showServers:function(){var e=BX(this.srvFrameObjectName),t=BX.Scale.serversCollection.getObjectsList(),i=e.children[0];if(e)for(var s in t)e.insertBefore(t[s].getDomObj(),i)},isObjectEmpty:function(e){for(var t in e)return false;return true},showActions:function(){var e=BX(this.frameObjectName);if(!e)return false;if(!this.isObjectEmpty(BX.Scale.serversCollection.getObjectsList()))e.insertBefore(this.getMenuObj(),e.children[0])},refreshingDataStart:function(e){BX.Scale.AdminFrame.refreshingDataIntervalId=setInterval(function(){BX.Scale.AdminFrame.refreshServersRolesLoadbars()},e)},setMonitoringValues:function(e){for(var t in e){var i=BX.Scale.serversCollection.getObject(t);if(e[t].ROLES_LOADBARS){for(var s in e[t].ROLES_LOADBARS){if(i&&i.roles&&i.roles[s]){i.roles[s].setLoadBarValue(e[t].ROLES_LOADBARS[s])}}}if(e[t].MONITORING_VALUES)i.setMonitoringValues(e[t].MONITORING_VALUES)}},refreshServersRolesLoadbars:function(){if(!BX.Scale.AdminFrame.monitoringParams){BX.Scale.AdminFrame.monitoringParams={};var e=BX.Scale.serversCollection.getObjectsList();for(var t in e){if(!BX.Scale.isMonitoringDbCreated[t])continue;BX.Scale.AdminFrame.monitoringParams[t]={rolesIds:[],monitoringParams:e[t].getMonitoringParams()};for(var i in e[t].roles){if(e[t].roles[i].loadBar!==null){BX.Scale.AdminFrame.monitoringParams[t].rolesIds.push(i)}}}}if(BX.Scale.isObjEmpty(BX.Scale.AdminFrame.monitoringParams))return;var s={operation:"get_monitoring_values",servers:BX.Scale.AdminFrame.monitoringParams};var n={onsuccess:function(e){if(e){if(e.MONITORING_DATA){BX.Scale.AdminFrame.setMonitoringValues(e.MONITORING_DATA)}if(e.ERROR&&e.ERROR.length>0){BX.debug("Monitoring data error: "+e.ERROR)}}else{BX.debug("Monitoring receiving data error.")}},onfailure:function(){BX.debug("Monitoring receiving data failure.")}};BX.Scale.Communicator.sendRequest(s,n,this,false)},getMenuObj:function(){var e=document.createElement("span");BX.addClass(e,"adm-scale-menu-btn");e.innerHTML=BX.message("SCALE_PANEL_JS_GLOBAL_ACTIONS");BX.bind(e,"click",BX.proxy(this.actionsMenuOpen,this));return BX.create("div",{children:[e],style:{padding:"0 0 40px 0"}})},actionsMenuOpen:function(t){t=t||e.event;var i=t.target||t.srcElement,s=[],n=[],a={MONITORING_ENABLE:true,MONITORING_DISABLE:true,SITE_ADD:true,SITE_DEL:true,SET_EMAIL_SETTINGS:true,CRON_SET:true,CRON_UNSET:true,HTTP_OFF:true,HTTP_ON:true,UPDATE_ALL_BVMS:true},r;for(var o in a){var l=BX.Scale.actionsCollection.getObject(o);if(l){if(o=="SET_EMAIL_SETTINGS"){n=[];for(r in BX.Scale.sitesList){n.push({TEXT:BX.Scale.sitesList[r].NAME,ONCLICK:"BX.Scale.actionsCollection.getObject('"+o+"').start('',{SITE_NAME_CONF: '"+BX.Scale.sitesList[r].SiteName+"', SITE_NAME: '"+BX.Scale.sitesList[r].NAME+"',SMTP_HOST: BX.Scale.sitesList['"+r+"'].SMTPHost,SMTP_PORT: BX.Scale.sitesList['"+r+"'].SMTPPort,SMTP_USER: BX.Scale.sitesList['"+r+"'].SMTPUser,EMAIL: BX.Scale.sitesList['"+r+"'].EmailAddress,SMTPTLS: (BX.Scale.sitesList['"+r+"'].SMTPTLS == 'on' ? 'Y' : 'N')});"})}s.push({TEXT:l.name,MENU:n})}else if(o=="CRON_SET"||o=="CRON_UNSET"){n=[];for(r in BX.Scale.sitesList){if(BX.Scale.sitesList[r].CronTask=="enable"&&o=="CRON_UNSET"||BX.Scale.sitesList[r].CronTask!="enable"&&o=="CRON_SET"){n.push({TEXT:BX.Scale.sitesList[r].NAME,ONCLICK:"BX.Scale.actionsCollection.getObject('"+o+"').start('',{VM_SITE_ID: '"+r+"'});"})}}if(n.length>0){s.push({TEXT:l.name,MENU:n})}}else if(o=="HTTP_OFF"||o=="HTTP_ON"){n=[];for(r in BX.Scale.sitesList){if(BX.Scale.sitesList[r].HTTPS=="enable"&&o=="HTTP_ON"||BX.Scale.sitesList[r].HTTPS!="enable"&&o=="HTTP_OFF"){n.push({TEXT:BX.Scale.sitesList[r].NAME,ONCLICK:"BX.Scale.actionsCollection.getObject('"+o+"').start('',{VM_SITE_ID: '"+r+"'});"})}}if(n.length>0){s.push({TEXT:l.name,MENU:n})}}else if(o=="SITE_ADD"){s.push({TEXT:l.name,ONCLICK:"BX.Scale.actionsCollection.getObject('"+o+"').start();"})}else if(o=="SITE_DEL"){n=[];for(r in BX.Scale.sitesList){n.push({TEXT:BX.Scale.sitesList[r].NAME,ONCLICK:"BX.Scale.actionsCollection.getObject('"+o+"').start('',{VM_SITE_ID: '"+r+"'})"})}s.push({TEXT:l.name,MENU:n})}else{s.push({TEXT:l.name,ONCLICK:"BX.Scale.actionsCollection.getObject('"+o+"').start();"})}}}if(!i.OPENER)BX.adminShowMenu(i,s,{active_class:"bx-adm-scale-menu-butt-active"});else i.OPENER.SetMenu(s);return BX.PreventDefault(t)},getNewServerName:function(e){if(!e)e=1;var t="server"+e;var i=BX.Scale.serversCollection.getObject(t);if(i!==false){e++;t=this.getNewServerName(e)}return t},alert:function(e,t,i){var s={title:BX.message("SCALE_PANEL_JS_CLOSE"),id:"btnClose",name:"btnClose",action:function(){this.parentWindow.Close();if(i&&typeof i==="function")i.apply()}};this.dialogWindow=new BX.CDialog({title:t?t:"",content:e,resizable:false,height:200,width:400,buttons:[s]});this.dialogWindow.adjustSizeEx();this.dialogWindow.Show()},confirm:function(e,t,i,s){var n={title:"OK",id:"btnOk",name:"btnOk",className:"adm-btn-save",action:function(){this.parentWindow.Close();if(i&&typeof i==="function")i.apply()}};var a={title:BX.message("SCALE_PANEL_JS_CANCEL"),id:"btnCancel",name:"btnCancel",action:function(){this.parentWindow.Close();if(s&&typeof s==="function")s.apply()}};this.dialogWindow=new BX.CDialog({title:t?t:"",content:e,resizable:false,height:200,width:400,buttons:[n,a]});this.dialogWindow.adjustSizeEx();this.dialogWindow.Show()},waitForAction:function(t){if(!t)return false;this.dialogWindow=new BX.CDialog({title:BX.message("SCALE_PANEL_JS_WFA_TITLE"),content:BX.message("SCALE_PANEL_JS_WFA_TEXT").replace("##BID##",t)+"<div class='bx-adm-scale-wait'></div>",resizable:false,height:200,width:400});this.dialogWindow.adjustSizeEx();this.dialogWindow.Show();this.failureAnswersCount=0;var i={operation:"check_state",bid:t};var s={onsuccess:function(t){this.failureAnswersCount=0;if(t.ACTION_STATE.status!="running"){e.location.reload(true)}},onfailure:function(t,i){BX.debug({type:t,error:i});if(this.failureAnswersCountAllow>=this.failureAnswersCount){this.failureAnswersCount++}else{e.location.reload(true)}}};var n=this;setInterval(function(){BX.Scale.Communicator.sendRequest(i,s,n,false)},n.timeAsyncRefresh);return true},waitForPageRefreshing:function(){var e=new BX.CDialog({title:BX.message("SCALE_PANEL_JS_REFRESH_TITLE"),content:BX.message("SCALE_PANEL_JS_REFRESH_TEXT"),resizable:false,height:200,width:400});e.adjustSizeEx();e.Show()}}})(window);
//# sourceMappingURL=admin_frame.map.js