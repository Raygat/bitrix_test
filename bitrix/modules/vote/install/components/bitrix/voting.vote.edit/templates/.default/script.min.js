(function(){if(window.BVoteConstructor)return;top.BVoteConstructor=window.BVoteConstructor=function(i){this.controller=i.controller;this.maxQ=parseInt(i["maxQ"]);this.maxA=parseInt(i["maxA"]);this.q={num:0,cnt:0};this.a=[{num:0,cnt:0}];this.InitVoteForm()};window.BVoteConstructor.prototype.checkAnswerAdding=function(i){var t=BX("question_"+i);if(this.a[i].list){if(this.a[i].list.firstChild){BX.unbindAll(t);var e=this.a[i].list.firstChild;do{BX.unbind(e.firstChild,"focus",BX.proxy(this._do,this))}while((e=e.nextSibling)&&BX(e))}}if(this.maxA>0&&this.a[i].cnt>=this.maxA){if(this.a[i].node){BX.hide(this.a[i].node)}return false}if(this.a[i].node){BX.show(this.a[i].node)}else if(this.a[i].list){if(this.a[i].list.lastChild){BX.bind(this.a[i].list.lastChild.firstChild,"focus",BX.proxy(this._do,this))}else{BX.bind(t,"focus",BX.proxy(this._do,this))}}return true};window.BVoteConstructor.prototype.checkQuestionAdding=function(){if(this.maxQ>0&&this.q.cnt>=this.maxQ){if(this.q.node)this.q.node.style.display="none";return false}if(this.q.node)this.q.node.style.display="";return true};window.BVoteConstructor.prototype.InitVoteForm=function(){var i=BX.findChild(this.controller,{tagName:"OL",className:"vote-questions"},true),t=i.childNodes,e=/question_(\d+)/gi,s=!!t?e.exec(i.lastChild.firstChild.firstChild.id):[0,0,0];this.q.cnt=t.length;this.q.num=parseInt(s[1]);this.q.node=BX.findChild(this.controller,{tagName:"A",className:"addq"},true);var n,r,a,d;for(d=0;d<t.length;d++){if(t[d]&&t[d]["tagName"]=="LI"){n=BX.findChild(t[d],{tagName:"OL"},true);r=BX.findChildren(n,{tagName:"LI"},false);a=/answer_(\d+)__(\d+)_/gi;s=[0,0,0];if(n.lastChild){s=a.exec(n.lastChild.firstChild.id)}else{s=e.exec(t[d].firstChild.firstChild.id);s[2]=0}this.a[s[1]]={cnt:r.length,num:parseInt(s[2]),node:false,list:n};this.checkAnswerAdding(s[1])}}this.checkQuestionAdding();var h=["LABEL","A"],o;for(var l in h){if(h.hasOwnProperty(l)){o=BX.findChildren(i.parentNode,{tagName:h[l]},true);for(d in o){if(o.hasOwnProperty(d))BX.bind(o[d],"click",BX.delegate(this._do,this))}}}};window.BVoteConstructor.prototype._do=function(i){BX.PreventDefault(i);var t=/(add|del)\w/,e=BX.proxy_context,s=t.exec(BX.proxy_context.className),n,r,a,d,h,o,l;if(!!s){switch(s[0]){case"adda":var c=BX.findParent(e,{className:"vote-question",tagName:"li"});h=BX.findChild(c,{tagName:"OL"},true);l=/answer_(\d+)__(\d+)_/i;d=l.exec(e.getAttribute("id"));if(!d){l=/question_(\d+)/i;d=l.exec(e.getAttribute("id"))}d=!!d?d[1]:null;if(d!=null&&this.checkAnswerAdding(d)){this.a[d].num++;this.a[d].cnt++;n=BX.create("DIV",{html:BX.message("VOTE_TEMPLATE_ANSWER").replace(/#Q#/gi,d).replace(/#A#/gi,this.a[d].num).replace(/#A_VALUE#/gi,"").replace(/#A_PH#/gi,this.a[d].num+1)});a=BX.findChildren(n.firstChild,{tagName:"LABEL"},true);for(r in a){if(a.hasOwnProperty(r)){BX.bind(a[r],"click",BX.delegate(this._do,this))}}h.appendChild(n.firstChild);this.checkAnswerAdding(d)}break;case"dela":l=/answer_(\d+)__(\d+)_/i;d=l.exec(e.getAttribute("for"));d=!!d?d[1]:null;var f=BX.findParent(e,{tagName:"li"});h=BX.findParent(f,{tagName:"OL"});e=BX(e.getAttribute("for"));if(e.value!=""&&!confirm(BX.message("VVE_ANS_DELETE")))return false;h.removeChild(f);this.a[d].cnt--;this.checkAnswerAdding(d);break;case"addq":if(this.checkQuestionAdding()){o=BX.findChild(e.parentNode,{tag:"OL"},false);this.q.num++;this.q.cnt++;n=BX.message("VOTE_TEMPLATE_ANSWER").replace(/#A#/gi,0).replace(/#A_PH#/gi,1).replace(/#A_VALUE#/gi,"")+BX.message("VOTE_TEMPLATE_ANSWER").replace(/#A#/gi,1).replace(/#A_PH#/gi,2).replace(/#A_VALUE#/gi,"");n=BX.create("DIV",{html:BX.message("VOTE_TEMPLATE_QUESTION").replace(/#ANSWERS#/gi,n).replace(/#Q#/gi,this.q.num).replace(/#Q_VALUE#/gi,"").replace(/#Q_MULTY#/gi,"")});a=BX.findChildren(n.firstChild,{tagName:"LABEL"},true);for(r in a){if(a.hasOwnProperty(r)){BX.bind(a[r],"click",BX.delegate(this._do,this))}}this.a[this.q.num]={num:1,cnt:2,node:false,list:BX.findChild(n,{tag:"OL"},true,false)};o.appendChild(n.firstChild);BX("question_"+this.q.num).focus();this.checkQuestionAdding();this.checkAnswerAdding(this.q.num)}break;case"delq":d=e.getAttribute("for");var u=e.previousSibling;o=BX.findParent(u,{tagName:"OL"});d=parseInt(d.replace(/question_/gi,""));if(u.value!=""&&!confirm(BX.message("VVE_QUESTION_DELETE")))return false;o.removeChild(BX.findParent(u,{tagName:"LI"}));this.q.cnt--;this.checkQuestionAdding();break}}return true}})();
//# sourceMappingURL=script.map.js